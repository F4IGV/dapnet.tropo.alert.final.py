# Tropo Forecast to DAPNET  
By F4IGV and ChatGPT  
ASCII only - POCSAG compatible

This Python script computes a simplified tropospheric propagation index using local weather data (via Open-Meteo API) and sends a compact ASCII alert message to multiple DAPNET callsigns when the tropo level exceeds a configurable threshold.

It is ideal for amateur radio operators interested in real-time tropo forecasts directly on their POCSAG pagers.

This script can be automated on Windows using Task Scheduler together with the `.bat` file included in this repository.  
The user must edit the `.bat` file and specify the full path to the `.py` script so automation works correctly.

---

## Features

- Retrieves current weather from the Open-Meteo API  
- Computes a multi-layer refractivity-based tropo index  
- Detailed logging (temperature layers, refractivity, gradients, index)  
- Sends a DAPNET alert when index >= configured threshold  
- Broadcast to multiple callsigns and transmitter groups  
- Fully ASCII formatted messages (POCSAG compatible)  
- Windows-friendly logging  

---

## Example DAPNET message

```text
Tropo:3.8 (Moyenne) T2m:14C RH:70% P:1013hPa
```

If tropo is below the threshold (default = 2.0), no alert is transmitted.

---

## Installation

### 1. Clone the repository
```bash
git clone https://github.com/your_username/your_repository.git
cd your_repository
```

### 2. Install Python 3
Python 3.8 or newer recommended.

Check version:
```bash
python --version
```

### 3. Install dependencies
```bash
pip install requests
```

---

## Configuration

Edit the script to configure your QTH and DAPNET settings:

### Geographic coordinates
```python
LAT = 48.1173
LON = -1.6778
```

### DAPNET settings
```python
DAPNET_USER = "f4abc"
DAPNET_PASS = "123456"
CALLSIGNS = ["f4abc", "f4def"]
TX_GROUPS = ["f-53"]
```

### Tropo alert threshold
```python
TROPO_MIN_LEVEL = 2.0
```

### Log file
```python
LOG_FILE = "tropo.log"
```

---

## Manual execution

```bash
python tropo_forecast.py
```

Example console output:
```text
[2025-01-12 13:00:02 UTC] Recuperation meteo Open-Meteo…
[2025-01-12 13:00:02 UTC] Donnees meteo recuperees : {'t2m': 17.3, 'wind_speed': 8.1, ...}
[2025-01-12 13:00:02 UTC] Temperatures approximatives : 2m=17.3°C, 100m=16.65°C...
[2025-01-12 13:00:02 UTC] Indice tropo calcule : 3.75
[2025-01-12 13:00:02 UTC] Niveau d'alerte : Moyenne
[2025-01-12 13:00:02 UTC] Message DAPNET propose : Tropo:3.8 (Moyenne) T2m:17C RH:70% P:1013hPa
[OK] Message envoye a DAPNET : 204
```

---

## How it works

1. Fetch weather from Open-Meteo (temperature, wind, pressure, humidity).  
2. Compute refractivity N for several atmospheric layers (2m, 100m, 925hPa, 850hPa).  
3. Convert refractivity into modified refractivity M.  
4. Calculate vertical gradients dM/dz.  
5. Combine gradients to compute the tropo index.  
6. Map index to descriptive category (Faible, Moyenne, Bonne, Forte/DX).  
7. If index >= threshold → send POCSAG message via DAPNET.  
8. Everything is logged in `tropo.log`.

---

## Project structure

```
tropo_forecast.py     # Main script
tropo.log             # Autogenerated log file
README.md             # Documentation
```

---

## Requirements

Install dependencies:
```bash
pip install requests
```

---

## Troubleshooting

- Weather not retrieved  
  - Open-Meteo may be unavailable  
  - Check internet connection  

- Index seems incorrect  
  - Open-Meteo missing humidity → default RH=70% applied  
  - Pressure assumed 1013 hPa if not provided  

- DAPNET not sending  
  - Check credentials  
  - Ensure callsigns are valid  
  - Verify transmitter group permissions  

- Log file not created  
  - Check write permissions in directory  

---

## License

This project is intended for amateur radio experimentation only.  
Use responsibly.

---

## Credits

Developed by **F4IGV** with assistance from **ChatGPT**.  
Thanks to the amateur radio community for testing and suggestions.



Exemple de log généré:

<img width="1181" height="618" alt="screen_log_tropo_alert" src="https://github.com/user-attachments/assets/4679f5d0-4eb4-4f50-a620-8656a6630b61" />
